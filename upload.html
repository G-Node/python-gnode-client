

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upload Data to the G-Node &mdash; Python G-Node Client 0.3.0 Beta documentation</title>
    
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.0 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Python G-Node Client 0.3.0 Beta documentation" href="index.html" />
    <link rel="prev" title="Get data from the G-Node" href="retrieval.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="retrieval.html" title="Get data from the G-Node"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Python G-Node Client 0.3.0 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="upload-data-to-the-g-node">
<h1>Upload Data to the G-Node<a class="headerlink" href="#upload-data-to-the-g-node" title="Permalink to this headline">¶</a></h1>
<p>So far this guide was mainly about how to connect to the G-Node REST API and retrieve data from the server.
But of course storing data on the server is also an important part of the workflow.
Therefore this topic will be covered by the following sections.
All code examples assume, that an open <tt class="xref py py-class docutils literal"><span class="pre">Session</span></tt> object <tt class="xref py py-obj docutils literal"><span class="pre">s</span></tt> exists and that the packages
<tt class="xref py py-mod docutils literal"><span class="pre">neo</span></tt> and <tt class="xref py py-mod docutils literal"><span class="pre">odml</span></tt> as well as the class <tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt> are imported.</p>
<div class="section" id="create-objects">
<h2>Create Objects<a class="headerlink" href="#create-objects" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in the previous chapter, all objects that are handled by the client are not pure neo or odml objects, but
contain additional information (such as the location) that is needed by the client in order to identify the object.
This has some serious consequences when it comes to object upload.
To demonstrate these consequences the following example shows how NOT to do it.
Let&#8217;s assume we want to create and upload a block and then change the block afterwards and save those changes too.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">block</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="s">&quot;A cool block&quot;</span><span class="p">)</span>      <span class="c"># Saves block as a new object</span>
<span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

<span class="n">block</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;A really cool block&quot;</span>     <span class="c"># Saves block as a new object too!!</span>
<span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

<span class="n">block</span><span class="o">.</span><span class="n">location</span>    <span class="c"># AttributeError: &#39;Block&#39; object has no attribute &#39;location&#39;</span>
</pre></div>
</td></tr></table></div>
<p>In the first two lines just happens what was to be expected: a new block with the name &#8220;A cool block&#8221; was crated and
uploaded to the server.
In line 5 we then changed the name of the block.
However, in line 6 some would probably expect that the previously uploaded block is now updated, but it is not.
Instead a new block with the name &#8220;A really cool block&#8221; was created on the server.
This is caused by the behaviour of all methods of <tt class="xref py py-class docutils literal"><span class="pre">Session</span></tt> which do not have side-effects.
In this case this means that the <tt class="xref py py-obj docutils literal"><span class="pre">block</span></tt> that is passed to <tt class="xref py py-meth docutils literal"><span class="pre">Session.set()</span></tt> remains unchanged.
To be more specific this means that <tt class="xref py py-obj docutils literal"><span class="pre">block</span></tt> still has no location assigned to it.
But without a location the client must assume that the object is a newly created object.</p>
<p>The solution to this problem is quite simple: <tt class="xref py py-meth docutils literal"><span class="pre">Session.set()</span></tt> returns a new instance of the object that was
passed as the first parameter.
This new instance contains all information that is needed by the client in order to identify the
object as something that already exists on the server.</p>
<p>This example demonstrate how it should be done:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">block</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="s">&quot;A cool block&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class="n">block</span><span class="o">.</span><span class="n">location</span>    <span class="c"># OK, it has a location</span>

<span class="n">block</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;A really cool block&quot;</span>
<span class="hll"><span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class="n">block</span><span class="o">.</span><span class="n">location</span>    <span class="c"># OK, it has a location</span>
</pre></div>
</td></tr></table></div>
<p>A good way to avoid errors is to create and upload an object simultaneously:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">neo</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="s">&quot;A cool block&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>The next example shows a more complex use-case, where a block, a segment and an analogsignal is created and uploaded
to the server:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">quantities</span> <span class="kn">as</span> <span class="nn">pq</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># create a block and a segment</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">neo</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="s">&quot;Experiment One&quot;</span><span class="p">))</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">neo</span><span class="o">.</span><span class="n">Segment</span><span class="p">(</span><span class="s">&quot;Trial 01&quot;</span><span class="p">,</span> <span class="p">))</span>

<span class="c"># associate the segment with block and save it</span>
<span class="n">segment</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>

<span class="c"># create a signal</span>
<span class="n">signal_data</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="s">&#39;mV&#39;</span><span class="p">)</span>
<span class="n">t_start</span><span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span>
<span class="n">sampling_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">Khz</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">AnalogSignal</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signal_data</span><span class="p">,</span> <span class="n">t_start</span><span class="o">=</span><span class="n">t_start</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sampling_rate</span><span class="p">)</span>

<span class="c"># associate the signal with the segment and save it again</span>
<span class="n">signal</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">segment</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Looking at this example more closely, it is worth to mention, that associations between entities can only be set on
the one-side of the one-to-many relationship. The code in the following example would have no effect.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">block</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="update-objects">
<h2>Update Objects<a class="headerlink" href="#update-objects" title="Permalink to this headline">¶</a></h2>
<p>Updating existing objects works very similar as the creation of new objects.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># get a block and a segment from the server</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/block/2DFA548ESC&quot;</span><span class="p">)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">)</span>

<span class="c"># change the name of the segment and associate it with the block</span>
<span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Trial 100&quot;</span>
<span class="n">segment</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>

<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upload Data to the G-Node</a><ul>
<li><a class="reference internal" href="#create-objects">Create Objects</a></li>
<li><a class="reference internal" href="#update-objects">Update Objects</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="retrieval.html"
                        title="previous chapter">Get data from the G-Node</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/upload.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="retrieval.html" title="Get data from the G-Node"
             >previous</a> |</li>
        <li><a href="index.html">Python G-Node Client 0.3.0 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Adrian Stoewer, Andrey Sobolev.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>