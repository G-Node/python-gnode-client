

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Get data from the G-Node &mdash; Python G-Node Client 0.2.0 Beta documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.0 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Python G-Node Client 0.2.0 Beta documentation" href="index.html" />
    <link rel="next" title="Upload Data to the G-Node" href="upload.html" />
    <link rel="prev" title="General concepts" href="general.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="upload.html" title="Upload Data to the G-Node"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="general.html" title="General concepts"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Python G-Node Client 0.2.0 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="get-data-from-the-g-node">
<h1>Get data from the G-Node<a class="headerlink" href="#get-data-from-the-g-node" title="Permalink to this headline">¶</a></h1>
<p>This chapter explains with some more examples, how data can be retrieved from the G-Node REST API.
In all the following code examples we assume that an open session object <tt class="xref py py-obj docutils literal"><span class="pre">s</span></tt> exists and that
the class <tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt> was imported.</p>
<div class="section" id="the-select-function">
<h2>The Select Function<a class="headerlink" href="#the-select-function" title="Permalink to this headline">¶</a></h2>
<p>The purpose of the <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> method is to retrieve a list of objects from a certain type from the
G-Node REST API.
See the documentation for a detailed description of the used <a class="reference external" href="http://g-node.github.io/g-node-portal/key_functions/object_model.html">object model</a>.
Further the <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> methods provides the possibility to filter the result by various criteria.
At the moment only so called raw filters are supported. Raw filters consist of a list of key value pairs represented as
a python dictionary.
The following example illustrates some common use cases for filters:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># splitting results</span>
<span class="n">signals</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">ANALOGSIGNAL</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;max_results&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>
<span class="n">signals</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">ANALOGSIGNAL</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;max_results&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>

<span class="c"># search for owner</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">BLOCK</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;owner&quot;</span><span class="p">:</span> <span class="s">&quot;bob&quot;</span><span class="p">})</span>

<span class="c"># search for certain properties</span>
<span class="n">segments</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">SEGMENT</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;name__icontains&quot;</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span><span class="p">})</span>
<span class="n">signals</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">ANALOGSIGNAL</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;t_start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c"># get all odML sections without a parent (root sections)</span>
<span class="n">sections</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">SECTION</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;parent_section__isnull&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="c"># combine filters</span>
<span class="c"># get the first hundred root sections that are owned by the user &quot;bob&quot;</span>
<span class="n">filers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;parent_section__isnull&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;max_results&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s">&quot;owner&quot;</span><span class="p">:</span> <span class="s">&quot;bob&quot;</span>
<span class="p">}</span>
<span class="n">sections</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">SECTION</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The basic syntax for raw filters is rather complex.
The documentation of the G-Node REST API describes how to <a class="reference external" href="http://g-node.github.io/g-node-portal/key_functions/data_api/query.html">query data</a> from the server in detail.</p>
<p>Since the filters can not be evaluated locally, the <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> method always requests data
from the server and never from the local cache.
Regarding performance this means, that <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> is comparably slow, on the other hand it ensures
that the result always contains the most recent versions of objects.</p>
</div>
<div class="section" id="the-get-function">
<h2>The Get Function<a class="headerlink" href="#the-get-function" title="Permalink to this headline">¶</a></h2>
<p>In contrast to <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> the <tt class="xref py py-meth docutils literal"><span class="pre">Session.get()</span></tt> method only returns one single object.
In order to do so, the client must know the type and id of an object.
This information is encoded in the location property of each object returned by the api.
Typical location strings have the following format &lt;category&gt;/&lt;type&gt;/&lt;id&gt; here are some examples:</p>
<ul class="simple">
<li>metadata/section/K6LO7NH133</li>
<li>electrophysiology/segment/3GQP0BTS90</li>
</ul>
<p>Without any other parameter <tt class="xref py py-meth docutils literal"><span class="pre">Session.get()</span></tt> will look up the requested object in the cache and return it.
Only if an object is missing from the cache it will be requested from the server.
If an object was not found at all <tt class="xref py py-meth docutils literal"><span class="pre">Session.get()</span></tt> returns <tt class="xref py py-const docutils literal"><span class="pre">None</span></tt>.
The following example demonstrates this behaviour.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># clear the cache</span>
<span class="n">s</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>

<span class="c"># get the segment from the server (slow)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">)</span>

<span class="c"># get the segment from the cache (fast)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">)</span>

<span class="c"># lazy loading data from the server (slow)</span>
<span class="n">noof_signals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">analogsignals</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>In some situations it is very useful to make sure that the most recent version of and object is returned, even if
a (potentially older) version was already cached.
For this purpose the method defines an optional parameter called <tt class="xref py py-obj docutils literal"><span class="pre">refresh</span></tt>.
If this parameter is set to <tt class="xref py py-const docutils literal"><span class="pre">True</span></tt> the client will check if there is a newer version on the server.
If this is not the case, the client will return the cached object.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">s</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>                                                         <span class="c"># clear the cache</span>

<span class="c"># get the segment from the server (slow)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># check first for newer version and get the data from the cache (medium)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Using the refresh parameter as shown above, also speeds up the performance in cases where the most recent
version was already cached, but is still considerably slower than without.</p>
<p>When working with larger datasets it can be quite annoying when some operations are fast (due to caching) whereas
other operations take longer.
Therefore the <tt class="xref py py-meth docutils literal"><span class="pre">Session.get()</span></tt> method provides a third optional parameter, that can be used to make sure, that
certain objects are cached.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># clear the cache</span>
<span class="n">s</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>

<span class="c"># load the most recent version of the segment and all its descendants to the cache (very slow)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># lazy loading is fast because it uses the cache</span>
<span class="n">noof_signals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">analogsignals</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="work-with-signal-data">
<h2>Work with Signal Data<a class="headerlink" href="#work-with-signal-data" title="Permalink to this headline">¶</a></h2>
<p>The next short example shows how signal data can be retrieved from the server and then plotted using matplotlib.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span>

<span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">)</span>
<span class="n">signals</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">analogsignals</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">dimensionality</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">dimensionality</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="get-permissions">
<h2>Get Permissions<a class="headerlink" href="#get-permissions" title="Permalink to this headline">¶</a></h2>
<p>Every kind of object that is returned by <tt class="xref py py-meth docutils literal"><span class="pre">Session.get()</span></tt> of <tt class="xref py py-meth docutils literal"><span class="pre">Session.select()</span></tt> has its own security
settings.
Those settings can be obtained using the <tt class="xref py py-meth docutils literal"><span class="pre">Session.permissions()</span></tt> method.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;electrophysiology/segment/K6LO7NH133&quot;</span><span class="p">)</span>
<span class="n">perms</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">permissions</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Get data from the G-Node</a><ul>
<li><a class="reference internal" href="#the-select-function">The Select Function</a></li>
<li><a class="reference internal" href="#the-get-function">The Get Function</a></li>
<li><a class="reference internal" href="#work-with-signal-data">Work with Signal Data</a></li>
<li><a class="reference internal" href="#get-permissions">Get Permissions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="general.html"
                        title="previous chapter">General concepts</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="upload.html"
                        title="next chapter">Upload Data to the G-Node</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/retrieval.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="upload.html" title="Upload Data to the G-Node"
             >next</a> |</li>
        <li class="right" >
          <a href="general.html" title="General concepts"
             >previous</a> |</li>
        <li><a href="index.html">Python G-Node Client 0.2.0 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Adrian Stoewer, Andrey Sobolev.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>